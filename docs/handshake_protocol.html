<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>handshake_protocol</title>
 <style>
		html {
		  color: #ddd; /* Text color */
		  background-color: #2c2d37; /* Background color */
		}
		body {
		  margin: 0 auto;
		  max-width: 50em;
		  padding-left: 50px;
		  padding-right: 50px;
		  padding-top: 50px;
		  padding-bottom: 50px;
		  hyphens: auto;
		  overflow-wrap: break-word;
		  text-rendering: optimizeLegibility;
		  font-kerning: normal;
		  background-color: #2c2d37; /* Background color */
		}
		@media (max-width: 600px) {
		  body {
			font-size: 0.9em;
			padding: 12px;
		  }
		  h1 {
			font-size: 1.8em;
		  }
		}
		@media print {
		  html {
			background-color: #fff; /* Background color */
		  }
		  body {
			background-color: #fff; /* Background color */
			color: #000; /* Text color */
			font-size: 12pt;
		  }
		  p, h2, h3 {
			orphans: 3;
			widows: 3;
		  }
		  h2, h3, h4 {
			page-break-after: avoid;
		  }
		}
		p {
		  margin: 1em 0;
		}
		a {
		  color: #ccc; /* Link color */
		}
		a:visited {
		  color: #ccc; /* Visited link color */
		}
		img {
		  max-width: 100%;
		}
		svg {
		  height: auto;
		  max-width: 100%;
		}
		h1, h2, h3, h4, h5, h6 {
		  margin-top: 1.4em;
		}
		h5, h6 {
		  font-size: 1em;
		  font-style: italic;
		}
		h6 {
		  font-weight: normal;
		}
		ol, ul {
		  padding-left: 1.7em;
		  margin-top: 1em;
		}
		li > ol, li > ul {
		  margin-top: 0;
		}
		blockquote {
		  margin: 1em 0 1em 1.7em;
		  padding-left: 1em;
		  border-left: 2px solid #555; /* Quote border color */
		  color: #999; /* Quote text color */
		}
		code {
		  font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
		  font-size: 85%;
		  margin: 0;
		  hyphens: manual;
		  background-color: #424249; /* Code background color */
		  color: #d7b17c; /* Code text color */
		  padding: 0.2em 0.4em; /* Code padding */
		  border-radius: 4px; /* Code border radius */
		}
		pre {
		  margin: 1em 0;
		  overflow: auto;
		}
		pre code {
		  padding: 0;
		  overflow: visible;
		  overflow-wrap: normal;
		}
		.sourceCode {
		 background-color: #424249; /* Code background color */
		 overflow: visible;
		}
		hr {
		  background-color: #444; /* Horizontal rule color */
		  border: none;
		  height: 1px;
		  margin: 1em 0;
		}
		table {
		  margin: 1em 0;
		  border-collapse: collapse;
		  width: 100%;
		  overflow-x: auto;
		  display: block;
		  font-variant-numeric: lining-nums tabular-nums;
		}
		table caption {
		  margin-bottom: 0.75em;
		}
		tbody {
		  margin-top: 0.5em;
		  border-top: 1px solid #444; /* Table border color */
		  border-bottom: 1px solid #444; /* Table border color */
		}
		th {
		  border-top: 1px solid #444; /* Table border color */
		  padding: 0.25em 0.5em 0.25em 0.5em;
		}
		td {
		  padding: 0.125em 0.5em 0.25em 0.5em;
		}
		header {
		  margin-bottom: 4em;
		  text-align: center;
		}
		#TOC li {
		  list-style: none;
		}
		#TOC ul {
		  padding-left: 1.3em;
		}
		#TOC > ul {
		  padding-left: 0;
		}
		#TOC a:not(:hover) {
		  text-decoration: none;
		}
		code{white-space: pre-wrap;}
		span.smallcaps{font-variant: small-caps;}
		div.columns{display: flex; gap: min(4vw, 1.5em);}
		div.column{flex: auto; overflow-x: auto;}
		div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
		/* The extra [class] is a hack that increases specificity enough to
		   override a similar rule in reveal.js */
		ul.task-list[class]{list-style: none;}
		ul.task-list li input[type="checkbox"] {
		  font-size: inherit;
		  width: 0.8em;
		  margin: 0 0.8em 0.2em -1.6em;
		  vertical-align: middle;
		}
		.display.math{display: block; text-align: center; margin: 0.5rem auto;}
	</style>
</head>
<body>
<h1 id="handshake-protocol">Handshake protocol ü§ù</h1>
<p><strong>It is really important to make connection between client and
server secured. That‚Äôs why we use fancy stuff like the Diffie-Hellman
algorithm, AES-128 encryption, and SHA256 hashing. It‚Äôs all about
keeping things secure! üîí</strong></p>
<h2 id="illustration-diagram">Illustration diagram</h2>
<figure>
<img src="assets/handshake.png" alt="Image showing handshake diagram" />
<figcaption aria-hidden="true">Image showing handshake
diagram</figcaption>
</figure>
<h2 id="client-side-handshake-algorithm">Client side handshake
algorithm</h2>
<ul>
<li>Generating Diffie-Hellman Values:
<ul>
<li>Generating <code>prime number (P)</code> and
<code>primitive root (G)</code>.</li>
<li>Generating <code>client private</code> and
<code>client public</code> keys using the generated prime number and
primitive root.</li>
<li>Constructing a string containing P, G, and the public key. Eg
<code>'p g publicKey'</code></li>
</ul></li>
<li>Send generated Diffie-Hellman string to the VPN server.</li>
<li>Receiving Response:
<ul>
<li>Spliting the response to extract the <code>server public key</code>
and <code>local IP</code> address.</li>
</ul></li>
<li>Calculating <code>shared secret</code> using the received
<code>server public key</code>, <code>client private key</code>, and
<code>prime number</code>.</li>
<li>Calculating encryption key via SHA256 (To be honest, we use only 16
characters or 128 bits). Let‚Äôs name it <code>sharedSecret</code>.</li>
<li>Retrieving <code>login</code> and <code>password</code> from
user.</li>
<li>Encrypting authentication fields:
<ul>
<li>Constructing a string containing the login and password. Eg
<code>'dima 1011'</code>.</li>
<li>Encrypting the authentication string via AES-128 using
<code>sharedSecret</code> as a key.</li>
</ul></li>
<li>Sending encrypted authentication data to the server.</li>
<li>Receiving server response:
<ul>
<li>Split the response to extract the status message <code>'OK'</code>
and the <code>VPN service port</code>.</li>
</ul></li>
<li>Checking if response contains <code>OK</code>.</li>
</ul>
<p><strong>Now the connection is secured.</strong></p>
<h2 id="server-side-handshake-algorithm">Server side handshake
algorithm</h2>
<ul>
<li>Receiving Diffie-Hellman Values:
<ul>
<li>Receiving the generated Diffie-Hellman string containing
<code>prime number (P)</code>, <code>primitive root (G)</code>, and
<code>client public key</code>.</li>
</ul></li>
<li>Generating <code>server private key</code> and
<code>server public key</code> using the received
<code>prime number</code> and <code>primitive root</code>.</li>
<li>Calculating <code>shared secret</code> using the received
<code>client public key</code>, <code>server private key</code>, and
<code>prime number</code>.</li>
<li>Calculating encryption key via SHA256 (To be honest, we use only 16
characters or 128 bits). Let‚Äôs name it <code>sharedSecret</code>.</li>
<li>Sending <code>server public key</code> and assigned
<code>virtual IP</code> to the client as a string. Eg
<code>'21783685 10.0.0.2'</code>.</li>
<li>Receiving client encrypted authentication string:
<ul>
<li>Decrypting string using the <code>sharedSecret</code>.</li>
<li>Extracting client <code>login</code> and <code>password</code>.</li>
</ul></li>
<li>Client authentication client:
<ul>
<li>Searching client in the database.</li>
</ul></li>
<li>Responding to the client with message which contains <code>OK</code>
and new random generated <code>VPNservice port</code> if client is
authorized. Eg <code>'OK 7215'</code>. Otherwise respond
<code>FAIL</code>.</li>
</ul>
<p><strong>Now the connection is secured.</strong></p>
<h2 id="secured-connection">Secured connection</h2>
<p>Once the connection is secure, all data exchanged between the client
and server gets encrypted with the AES-128 and <code>sharedSecret</code>
key, guaranteeing safety. The client then starts routing all traffic to
the VPN server, while the server redirects it to its intended
destinations, such as YouTube or other services.</p>
</body>
</html>
